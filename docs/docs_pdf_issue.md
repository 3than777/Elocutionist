## PDF Text Extraction Issue with Google Docs

### Issue
When users upload PDFs exported from Google Docs, the text extraction sometimes only captures page headers/footers (URLs and page numbers) instead of the actual document content. This causes the AI to not receive the user's actual information.

### Root Cause
The pdf-parse library sometimes has difficulty extracting text from certain PDF formats, particularly those generated by Google Docs' export function. The extraction might only capture header/footer information like:
```
8/7/25, 2:23 PMUser_profile - Google Docs
Page 1 of 3https://docs.google.com/document/d/18MX9tKhEMg455gwUV90tDhBJZFqxpljEw_VYJG6G-HM/edit?tab=t.0
```

### Solution Implemented
1. **Enhanced userId conversion**: Added robust ObjectId conversion with string cleaning to handle potential quotes
2. **Better error handling**: Added try-catch blocks around userId conversion
3. **Manual content update**: For affected files, manually updated the extractedText field in the database
4. **User ID consistency**: Backend now returns both `id` and `_id` fields in auth responses for compatibility

### Future Improvements Needed
1. **Alternative PDF extraction**: Consider using alternative libraries like `pdfjs-dist` or `pdf2json` for better Google Docs PDF support
2. **Content validation**: Add validation after extraction to ensure meaningful content was captured (e.g., minimum word count, no URL-only content)
3. **Fallback OCR**: If text extraction fails or returns only headers, fall back to OCR-based extraction
4. **User notification**: Notify users if their file extraction seems incomplete
5. **Plain text upload**: Allow users to upload .txt files as an alternative to PDFs

### Key Learnings
- Always validate extracted content quality, not just presence
- Google Docs PDFs may require special handling
- User ID type consistency between frontend and backend is crucial for database queries
- The pdf-parse library has limitations with certain PDF formats

## File Upload Detection Issue in Chat

### Issue
The chat interface was unable to detect uploaded files containing user information, preventing the AI from accessing user context during conversations.

### Root Cause
1. **User ID format mismatch**: The backend was receiving user IDs that sometimes included quotes or had type inconsistencies
2. **ObjectId conversion failures**: String user IDs weren't being properly converted to MongoDB ObjectIds
3. **Inconsistent user object structure**: The auth middleware wasn't providing both `id` and `_id` fields consistently

### Solution
1. **Enhanced ObjectId conversion**: Added robust string cleaning and validation before converting to ObjectId
2. **Better error handling**: Added try-catch blocks with proper fallbacks instead of throwing errors
3. **Standardized user object**: Auth middleware now always provides both `_id` (ObjectId) and `id` (string) fields
4. **Improved debugging**: Added detailed logging for troubleshooting user ID issues

### Files Modified
- `src/routes/chat.routes.ts`: Enhanced user ID handling in both authenticated and non-authenticated routes
- `src/middleware/auth.ts`: Standardized user object structure with both `_id` and `id` fields

### Key Learnings
- Always handle multiple ID formats (string vs ObjectId) in MongoDB queries
- Provide both `_id` and `id` fields in user objects for maximum compatibility
- Use `.trim()` and `.replace(/['"]/g, '')` to clean user IDs before conversion
- Add proper validation with `Types.ObjectId.isValid()` before attempting conversion
- Don't let ID conversion errors break the entire request - fail gracefully